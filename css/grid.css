/* ==========================================================================
   Grid Game Main Styles
   Contains styles for the game grid, scroll areas, and general layout
   
   CONTENTS:
   1. Game Container & General Layout
   2a. Grid Container & Cells
   2b. Snake cells
   2c. Wordchecker
   3. Scroll Areas (Replacing Arrow Buttons)
   4. Phrase Display
   5. Menu System (Replacing Refresh Buttons)
   6. Menu Animations
   7. Animation and Touch Handling
   8. Erosion and Animation Effects
   ========================================================================== */

/* ==========================================================================
   Color Variables - Theme Colors
   ========================================================================== */
:root {
  /* Island Theme Primary Colors */
  --lightblue: #64C0EB;    /* shore line lighter blue */
  --defaultblue: #56A5D6;  /* darker blue for main sea and default */
  --maingreen: #61E7A7;    /* main island cell green */
  --startgreen: #19C773;   /* start cell green */
  --sandyellow: #F6EC74;   /* yellow sand border */
  
  /* Derived/Secondary Colors */
  --defaultblue-dark: #4A91BB;      /* darker border for main sea */
  --defaultblue-darker: #3A82AD;    /* out of bounds background */
  --defaultblue-darkest: #2E6C94;   /* out of bounds border */
  --defaultblue-light: #78C9EF;     /* hover effect for sea cells */
  --maingreen-dark: #4BC98A;        /* border for island cells */
  --maingreen-light: #7DEEB6;       /* hover effect for island cells */
  --maingreen-lighter: #8CEFC0;     /* hover effect for selected cells */
  
  /* Text and Other UI Colors */
  --text-dark: #004d40;             /* dark teal for text on islands */
  --box-shadow-color: rgba(0, 77, 64, 0.4); /* shadow for cells */
}

/* ==========================================================================
   1. Game Container & General Layout
   ========================================================================== */

body {
    font-family: 'Trebuchet MS', Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f5f5f5;
    color: #333;
    overflow-x: hidden;
}

.game-container {
    max-width: 890px;
    margin: 0 auto;
    padding: 10px 20px 20px 20px; /* Reduced top padding */
    position: relative;
}

/* Remove game-title as requested */
.game-title {
    display: none;
}

/* Remove original info box as requested */
#game-info {
    display: none;
}

/* Medium screens */
@media (max-width: 768px) {
    .game-container {
        padding: 10px;
    }
}

/* Small screens */
@media (max-width: 480px) {
    .game-container {
        padding: 8px;
    }
}


/* ==========================================================================
   2a. Grid Container & Cells - Island Theme (FIXED VERSION)
   Completely rewritten to solve beach cell flashing during scrolling
   ========================================================================== */

/* Grid container wrapper - ensure proper dimensions */
.grid-container-wrapper,
#grid-container {
    width: 100%;
    margin: 0;
    position: relative;
    display: flex;
    justify-content: center;
}

#grid-container {
    min-height: 450px; /* Ensure minimum height */
}

.grid-container {
    display: grid;
    gap: 0; /* Remove gaps between cells for a continuous sea */
    background-color: var(--defaultblue); /* Main sea color */
    border: 2px solid var(--defaultblue-dark); /* Slightly darker border */
    border-radius: 4px;
    padding: 2px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    position: relative;
    margin: 0 auto;
    width: fit-content;
    height: fit-content;
    /* Enhanced touch behaviors for more reliable swipe handling */
    touch-action: none !important;
    user-select: none;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    /* Prevent highlight color on tap for iOS */
    -webkit-tap-highlight-color: transparent;
    z-index: 10; /* Higher z-index to appear above scroll areas */
    
    /* FIXED: Enhanced transform handling for smoother scrolling */
    transform-style: flat;
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
    /* Optimize transition timing for consistent animations */
    transition-property: transform;
    transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Optimize transition timing for grid scrolling */
.grid-container.fast-scroll {
    transition-duration: 180ms !important; /* Slightly faster for smooth animations */
}

.grid-container.slow-scroll {
    transition-duration: 350ms !important; /* Slightly shorter for better responsiveness */
}

/* Default grid template for desktop */
.grid-container[data-grid-size="desktop"] {
    grid-template-columns: repeat(15, 45px);
    grid-template-rows: repeat(11, 45px);
}

/* Grid template for mobile */
.grid-container[data-grid-size="mobile"] {
    grid-template-columns: repeat(9, 45px);
    grid-template-rows: repeat(9, 45px);
}

/* Default non-letter cell - deep blue sea */
.grid-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--defaultblue); /* Main sea color */
    color: transparent; /* Hide the dot by making text transparent */
    border: 1px solid var(--defaultblue-dark); /* Slightly darker border */
    text-shadow: none; /* Remove text shadow */
    border-radius: 4px;
    font-family: 'Trebuchet MS', Arial, sans-serif;
    font-weight: bold;
    font-size: 1.4rem;
    user-select: none;
    box-sizing: border-box;
    width: 50px;
    height: 50px;
    pointer-events: auto;
    margin: 0; /* No margins between cells */
    z-index: 1;
    overflow: hidden; /* Keep snake pieces within the cell boundaries */
    
    /* FIXED: Position is critical for stacking context */
    position: relative !important;
    
    /* FIXED: Remove transition from base cell style */
    /* This prevents conflicts during scrolling transforms */
    transition: none; 
    
    /* FIXED: Hardware acceleration but limited will-change */
    transform: translateZ(0);
    backface-visibility: hidden;
}

/* FIXED: Beach cells (sea-adjacent) with optimized rendering */
.grid-cell.sea-adjacent {
    /* FIXED: Strong styling with !important to maintain during transforms */
    background-color: var(--lightblue) !important; /* Shore line lighter blue */
    border-color: var(--defaultblue) !important; /* Border matches the main sea color */
    /* FIXED: Remove transition to prevent flashing */
    transition: none !important;
    /* FIXED: Higher z-index to maintain stack order during scrolling */
    z-index: 2 !important;
    /* FIXED: Enhanced GPU acceleration */
    will-change: transform !important;
    /* FIXED: Prevent flashing by ensuring contained in own stacking context */
    transform: translateZ(0);
    backface-visibility: hidden;
}

/* FIXED: No-transition class for beach cells */
.grid-cell.sea-adjacent.no-transition {
    transition: none !important;
}

/* FIXED: Preserved beach cell styles during transforms */
.grid-cell.preserved-beach-cell {
    background-color: var(--lightblue) !important;
    transition: none !important;
    z-index: 2 !important;
    /* Hardware acceleration */
    transform: translateZ(0);
    backface-visibility: hidden;
}

/* Style for letter cells - green islands */
.grid-cell.path-cell {
    background-color: var(--maingreen) !important; /* Main island green */
    color: var(--text-dark) !important; /* Dark teal for letters */
    border: 1px solid var(--maingreen-dark) !important; /* Slightly darker green border */
    text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.8) !important;
}

/* FIXED: Beach cell edge styling - TOP */
.grid-cell.sea-adjacent.shore-edge-top,
.grid-cell.preserved-beach-cell.shore-edge-top {
    border-top: 6px solid var(--sandyellow) !important; /* Yellow border on TOP when island is above */
    /* FIXED: Remove transition to prevent flashing */
    transition: none !important;
}

/* FIXED: Beach cell edge styling - RIGHT */
.grid-cell.sea-adjacent.shore-edge-right,
.grid-cell.preserved-beach-cell.shore-edge-right {
    border-right: 6px solid var(--sandyellow) !important; /* Yellow border on RIGHT when island is to the right */
    /* FIXED: Remove transition to prevent flashing */
    transition: none !important;
}

/* FIXED: Beach cell edge styling - BOTTOM */
.grid-cell.sea-adjacent.shore-edge-bottom,
.grid-cell.preserved-beach-cell.shore-edge-bottom {
    border-bottom: 6px solid var(--sandyellow) !important; /* Yellow border on BOTTOM when island is below */
    /* FIXED: Remove transition to prevent flashing */
    transition: none !important;
}

/* FIXED: Beach cell edge styling - LEFT */
.grid-cell.sea-adjacent.shore-edge-left,
.grid-cell.preserved-beach-cell.shore-edge-left {
    border-left: 6px solid var(--sandyellow) !important; /* Yellow border on LEFT when island is to the left */
    /* FIXED: Remove transition to prevent flashing */
    transition: none !important;
}

/* Start cell style to match island cells for snake path */
.grid-cell.start-cell {
    background-color: var(--startgreen) !important; /* Start cell green */
    color: var(--text-dark) !important; /* Dark teal for better visibility */
    font-weight: bold !important;
    box-shadow: 0 0 5px var(--box-shadow-color) !important;
    z-index: 3 !important;
}

.grid-cell.start-cell.selected-cell {
    background-color: var(--maingreen) !important; /* Match other selected cells with main island green */
    border-color: var(--startgreen) !important; /* Use start cell green as border for emphasis */
    box-shadow: 0 0 6px rgba(0, 77, 64, 0.5) !important;
}

/* Style for revealed hint cells - preserve as red */
.grid-cell.revealed-cell {
    background-color: #ffcdd2 !important; /* Light red */
    border: 1px solid #e57373 !important; /* Slightly darker red border */
    color: #d32f2f !important; /* Darker red for the letter */
    box-shadow: inset 0 0 5px rgba(211, 47, 47, 0.3) !important;
    text-shadow: none !important;
    z-index: 4 !important; /* Higher than regular cells */
}

/* Selected cell style - to match island theme for snake pieces */
.grid-cell.selected-cell {
    background-color: var(--maingreen) !important; /* Same as island cells */
    color: var(--text-dark) !important; /* Dark teal for visible text */
    border: 2px solid var(--maingreen-dark) !important; /* Slightly thicker border */
    text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.8) !important;
    z-index: 6 !important; /* Ensure selected is on top */
}

/* Completed path style - lighter green with visible text */
.grid-cell.completed-cell {
    background-color: var(--maingreen) !important; /* Use island green instead */
    border-color: var(--maingreen-dark) !important;
    color: var(--text-dark) !important;
    border: 1px solid var(--maingreen-dark) !important;
    text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.8) !important;
    z-index: 7 !important;
}

.grid-cell.correct-path {
    background-color: var(--maingreen) !important; /* Use island green instead */
    border-color: var(--maingreen-dark) !important;
}

/* Out of bounds cells as darker blue */
.grid-cell.out-of-bounds {
    background-color: var(--defaultblue-darker); /* Darker shade for out of bounds */
    color: transparent; /* Hide the X by making text transparent */
    border-color: var(--defaultblue-darkest); /* Even darker blue border */
}

/* Style for cells being touched - improved for better visual feedback */
.grid-cell.touch-active {
    box-shadow: 0 0 8px rgba(33, 150, 243, 0.5) !important;
    border-color: #0D47A1 !important;
    /* Speed up the touch feedback transition */
    transition: box-shadow 0.1s ease, border-color 0.1s ease;
}

/* Animation for invalid selections - no transform */
@keyframes invalid-selection-pulse {
    0% { background-color: #f0f0f0; border-color: #ccc; }
    50% { background-color: #ff6b6b; border-color: #d32f2f; }
    100% { background-color: #f0f0f0; border-color: #ccc; }
}

.grid-cell.invalid-selection {
    animation: invalid-selection-pulse 0.3s ease;
}

/* FIXED: Apply transitions only on hover for regular sea cells */
.grid-cell:not(.sea-adjacent):not(.path-cell):not(.preserved-beach-cell) {
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

/* FIXED: Hover effects with explicit transitions only when needed */
@media (hover: hover) and (pointer: fine) {
    /* Hover for sea cells */
    .grid-cell:not(.path-cell):not(.start-cell):not(.out-of-bounds):hover {
        background-color: var(--defaultblue-light); /* Lighter blue on hover */
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }
    
    /* Hover for letter island cells */
    .grid-cell.path-cell:hover:not(.selected-cell):not(.start-cell):not(.revealed-cell):not(.completed-cell) {
        background-color: var(--maingreen-light) !important; /* Lighter green on hover */
        cursor: pointer;
    }
    
    /* Ensure selected state always has correct hover style with snake pieces */
    .grid-cell.selected-cell:hover {
        background-color: var(--maingreen-lighter) !important; /* Even lighter green for selected hover */
        cursor: pointer;
    }
    
    /* Hover effect for revealed cells */
    .grid-cell.revealed-cell:hover:not(.selected-cell):not(.completed-cell) {
        background-color: #ef9a9a !important; /* Slightly darker red on hover */
        cursor: pointer;
    }
    
    /* Keep hover for completed */
    .grid-cell.completed-cell:hover {
        background-color: #c8e6c9 !important; /* Keep green for completed when hovering */
        cursor: default !important; /* Change cursor to default for completed cells */
    }
}

/* Medium screens */
@media (max-width: 768px) {
    .grid-cell {
        font-size: 1.3rem;
    }
}

/* Small screens */
@media (max-width: 480px) {
    .grid-cell {
        font-size: 1.1rem;
    }
}

/* FIXED: Improved mobile handling by completely disabling transitions */
@media (pointer: coarse) {
    .grid-cell, 
    .grid-cell.sea-adjacent,
    .grid-container.fast-scroll,
    .grid-container.slow-scroll {
        transition: none !important;
    }
    
    /* FIXED: Prevent transform-related flashing on mobile */
    .grid-cell.sea-adjacent {
        will-change: auto !important;
    }
    
    /* Improve touch handling on mobile */
    .grid-container {
        touch-action: none !important;
    }
    
    /* Make selected cells more visible on touch devices */
    .grid-cell.selected-cell {
        border-width: 3px;
    }
}

/* FIXED: iOS and Safari specific improvements */
@supports (-webkit-touch-callout: none) {
    .grid-cell {
        /* Prevent highlight color on tap */
        -webkit-tap-highlight-color: transparent;
        /* Disable iOS callouts */
        -webkit-touch-callout: none;
    }
    
    /* FIXED: Prevent transform-related flashing on iOS */
    .grid-cell.sea-adjacent,
    .grid-cell.preserved-beach-cell {
        -webkit-transform: translateZ(0);
        -webkit-backface-visibility: hidden;
        -webkit-perspective: 1000;
    }
    
    /* FIXED: Override transitions for iOS */
    .grid-container.fast-scroll,
    .grid-container.slow-scroll {
        -webkit-transition-property: -webkit-transform;
        -webkit-transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
    }
}

/* ==========================================================================
   2b. Snake Cells
   ========================================================================== */

/* Base styles for snake pieces */
.snake-piece {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    pointer-events: none !important; /* Allow clicks to pass through to the cell */
    z-index: 500 !important; /* Much higher z-index to ensure visibility over cells */
    object-fit: contain; /* Ensure image scales to fit while maintaining aspect ratio */
     background-size: contain !important;
  background-position: center !important;
  background-repeat: no-repeat !important;
   image-rendering: -webkit-optimize-contrast;
    transform-origin: center;
    transition: visibility 0.1s ease, transform 0.2s ease; /* Add visibility transition for flashing */
    overflow: hidden; /* Keep pieces contained within cell boundaries */
    display: block; /* Ensure the images are displayed */
    opacity: 1; /* Full opacity for better visibility */
}

/* Specific styling for each piece type */
.snake-tail {
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.3));
}

.snake-straight {
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.3));
}

.snake-curved {
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.3));
}

.snake-head {
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.3));
    z-index: 11; /* Ensure head is on top */
}

/* Flash animation keyframes for visibility toggling */
@keyframes flash-visibility {
  0% { visibility: visible; }
  50% { visibility: hidden; }
  100% { visibility: visible; }
}

/* Class that can be added to apply the flash animation */
.snake-flash-animation {
  animation: flash-visibility 1s ease 2; /* 1s duration, 2 iterations */
}

/* Remove continuous pulse animation on completed path to not interfere with flash */
@keyframes snake-completed-pulse {
    0% { filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.3)); }
    50% { filter: drop-shadow(0 0 6px rgba(76, 175, 80, 0.7)); }
    100% { filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.3)); }
}

/* Don't apply continuous animation to completed cells - will be replaced by flash */
.grid-cell.completed-cell .snake-piece {
    /* animation: snake-completed-pulse 2s infinite; */
    /* Animation removed to allow for the flash effect instead */
    filter: drop-shadow(0 0 3px rgba(76, 175, 80, 0.5));
}

/* Ensure snake pieces have higher z-index than background but lower than letters */
.grid-cell.selected-cell .snake-piece {
    z-index: 550 !important; /* Above the cell background, below the letter */
}

/* Make letters visible above snake pieces */
.grid-cell.selected-cell {
    color: #004d40 !important; /* Dark teal color for letters */
    font-weight: bold;
    text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
    position: relative; /* Required for z-index to work */
}

/* Special styling for special cell states */
.grid-cell.revealed-cell .snake-piece {
    opacity: 0.7; /* More transparency on hint cells */
}

/* Ensure completed cells maintain green background */
.grid-cell.completed-cell {
    background-color: var(--color-path-bg, #90ee90) !important;
    border-color: var(--color-path-border, #008000) !important;
    color: var(--text-dark, #004d40) !important; /* Dark teal for text */
    border: 1px solid #81c784 !important; /* Lighter green border */
    text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.8) !important;
    z-index: 7 !important; /* Ensure completed is on top of other states */
}

/* Remove any yellow/different coloring for correct path */
.grid-cell.correct-path {
    background-color: var(--color-path-bg, #90ee90) !important;
    border-color: var(--color-path-border, #008000) !important;
}

/* Responsive styles for snake pieces */
@media (max-width: 768px) {
    .snake-piece {
        padding: 2px; /* Add a slight padding on smaller screens */
    }
}

@media (max-width: 480px) {
    .snake-piece {
        padding: 3px; /* Add more padding on very small screens */
    }
}

/* Special snake piece styles for start and end of path */
.grid-cell.start-cell .snake-tail {
    z-index: 12; /* Ensure tail is properly visible on start cell */
}

.grid-cell.selected-cell:last-child .snake-head {
    z-index: 12; /* Make the head more visible when it's the last selected cell */
    filter: drop-shadow(0 0 4px rgba(76, 175, 80, 0.5));
}

/* Hover effects for cells with snake pieces */
@media (hover: hover) and (pointer: fine) {
    .grid-cell.selected-cell:hover .snake-piece {
        filter: drop-shadow(0 0 4px rgba(0, 150, 136, 0.6));
    }
}

/* Fix for iOS and Safari */
@supports (-webkit-touch-callout: none) {
    .snake-piece {
        /* Prevent highlight color on tap */
        -webkit-tap-highlight-color: transparent;
    }
}

/* ==========================================================================
   2c. Wordchecker
   ========================================================================== */

/* CSS for Word Checker Functionality */

/* Animation for word completion flash effect - IMPROVED */
@keyframes word-completed-flash {
  0% { background-color: var(--maingreen) !important; }
  50% { background-color: #3b9c68 !important; /* Darker green */ }
  100% { background-color: var(--maingreen) !important; }
}

/* Class applied to cells when a word is completed - IMPROVED */
.grid-cell.word-completed-flash {
  animation: word-completed-flash 0.5s ease-in-out !important;
  transition: none !important; /* Override any existing transitions */
}

/* Style for completed word characters in phrase display */
.completed-word-char {
  color: black !important;
  font-weight: bold !important;
}

/* Style for punctuation and special characters - always black */
.phrase-char.punctuation-char {
  color: black !important;
}

/* Style for revealed hint letters - also black from the start */
.phrase-char.hint-letter {
  color: black !important;
}

/* Initial style for all other phrase characters */
#phrase-text .phrase-char:not(.completed-word-char):not(.punctuation-char):not(.hint-letter) {
  color: #999999 !important; /* Light grey */
}

/* Animation for hint letter matches */
@keyframes hint-letter-pulse {
  0% { font-weight: normal; transform: scale(1); }
  50% { font-weight: bold; transform: scale(1.2); color: #4CAF50; }
  100% { font-weight: normal; transform: scale(1); }
}

/* Class to apply the hint matching animation */
.hint-letter-match {
  display: inline-block;
  animation: hint-letter-pulse 1s ease-in-out;
}

/* ==========================================================================
   3. Scroll Areas
   ========================================================================== */
/* Hide the original arrow buttons */
.arrow-buttons-wrapper {
    display: none !important;
}

/* Gameplay area with grid and scroll regions */
#gameplay-area {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 auto;
}

/* Horizontal container for grid and left/right scroll areas */
#scroll-horizontal-container {
    display: flex;
    width: 100%;
    justify-content: center;
    align-items: center;
    gap: 0; /* Ensure no gaps between grid and side arrows */
}

/* Base styles for all scroll areas */
.scroll-area {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: transparent;
    cursor: pointer;
    transition: background-color 0.15s ease;
    z-index: 5;
    margin: 0; /* Remove all margins by default */
}

/* Directional scroll areas - size and positioning */
.scroll-area-top,
.scroll-area-bottom {
    width: 100%;
    height: 160px;
    border-radius: 8px;
}

.scroll-area-left,
.scroll-area-right {
    width: 180px;
    height: 100%;
    border-radius: 8px;
}

/* Small spacing adjustments - minimal to maintain attachment */
.scroll-area-top {
    margin-bottom: 0;
}

.scroll-area-bottom {
    margin-top: 0;
}

/* Interactive states for all scroll areas */
.scroll-area:hover:not(.disabled) {
    background-color: transparent;
}

.scroll-area:active:not(.disabled) {
    background-color: rgba(200, 200, 200, 0.5);
}

.scroll-area.active {
    animation: pulse-and-fade 0.15s ease forwards;
}

.scroll-area.auto-scroll-feedback {
    animation: pulse-highlight 0.3s ease-in-out;
}

.scroll-area.disabled {
    opacity: 0.4;
    cursor: default;
    pointer-events: none;
}

/* Scroll arrow styling */
.scroll-arrow {
    font-size: 2rem;
    color: #555;
    text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.8),
                 0px -1px 1px rgba(0, 0, 0, 0.2);
    user-select: none;
    transform: scale(1);
    transition: transform 0.2s ease;
}

.scroll-area:hover:not(.disabled) .scroll-arrow {
    transform: scale(1.1);
}

.scroll-area:active:not(.disabled) .scroll-arrow {
    transform: scale(0.9);
}

/* Grid container transition effects */
.grid-container {
    transition-property: transform;
    transition-timing-function: ease-out;
}

.grid-container.fast-scroll {
    transition-duration: 400ms;
}

.grid-container.slow-scroll {
    transition-duration: 3000ms;
}

/* Selected cell visibility during auto-scroll */
.selected-cell {
    transition: box-shadow 0.15s ease;
}

.grid-cell.selected-cell:last-of-type {
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
}

/* Animation keyframes */
@keyframes pulse-and-fade {
    0% { background-color: rgba(200, 200, 200, 0.5); }
    100% { background-color: transparent; }
}

@keyframes pulse-highlight {
    0% { background-color: rgba(255, 255, 255, 0.1); }
    50% { background-color: rgba(200, 200, 200, 0.4); }
    100% { background-color: rgba(255, 255, 255, 0.1); }
}

/* Responsive styles */
@media (max-width: 768px) {
    #gameplay-area {
        margin: 20px auto 0;
    }
    
    .scroll-area-top,
    .scroll-area-bottom {
        height: 80px;
    }
    
    .scroll-area-left,
    .scroll-area-right {
        width: 80px;
    }
    
    .scroll-arrow {
        font-size: 1.5rem;
    }
}

@media (max-width: 480px) {
    #gameplay-area {
        margin: 15px auto 0;
    }
    
    .scroll-area-top,
    .scroll-area-bottom {
        height: 70px;
    }
    
    .scroll-area-left,
    .scroll-area-right {
        width: 70px;
    }
    
    .scroll-arrow {
        font-size: 1.3rem;
    }
}

/* ==========================================================================
   4. Redesigned Phrase Display
   ========================================================================== */

/* New phrase display attached directly beneath grid */
.phrase-display {
    width: 100%;
    max-width: 650px; /* Will be adjusted with JS to match grid width */
    margin: 0 auto;
    padding: 15px;
    background-color: var(--box-bg-color);
    border: 1px solid var(--box-border-color);
    border-top: 2px solid var(--btn-metal-lighter);
    border-left: 2px solid var(--btn-metal-light);
    border-right: 2px solid var(--btn-metal-dark);
    border-bottom: 3px solid var(--btn-metal-darker);
    border-radius: 0 0 8px 8px;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    box-shadow: 
        0 8px 15px 3px rgba(0, 0, 0, 0.2),
        0 2px 8px 2px var(--btn-metal-shadow);
    box-sizing: border-box;
    min-height: 60px;
    transition: min-height 0.3s ease;
}

#phrase-text {
    font-size: 1.3rem;
    letter-spacing: 2px;
    text-align: center;
    margin: 0;
    padding: 0;
    font-family: monospace;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.4;
    color: #444;
    text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.8),
                 0px -1px 1px rgba(0, 0, 0, 0.2);
}

/* Medium screens */
@media (max-width: 768px) {
    .phrase-display {
        padding: 12px;
        min-height: 55px;
    }
    
    #phrase-text {
        font-size: 1.1rem;
        letter-spacing: 1.5px;
    }
}

/* Small screens */
@media (max-width: 480px) {
    .phrase-display {
        padding: 10px;
        min-height: 50px;
    }
    
    #phrase-text {
        font-size: 0.95rem;
        letter-spacing: 1px;
    }
}

/* Animation for hint letter matches */
@keyframes hint-letter-pulse {
  0% { font-weight: normal; transform: scale(1); }
  50% { font-weight: bold; transform: scale(1.2); color: #4CAF50; }
  100% { font-weight: normal; transform: scale(1); }
}

/* Class to apply the animation */
.hint-letter-match {
  display: inline-block;
  animation: hint-letter-pulse 1s ease-in-out;
}

/* ==========================================================================
   5. Menu System (Replacing Refresh Buttons)
   ========================================================================== */
#menu-button-container {
    position: absolute;
    top: 10px;
    right: 20px;
    z-index: 100;
}

.menu-button {
    width: 44px;
    height: 44px;
    border-radius: 4px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f0f0f0; /* Explicit background color */
    border: 1px solid #cccccc; /* Explicit border */
}

.menu-icon {
    position: relative;
    width: 24px;
    height: 18px;
}

.menu-icon::before,
.menu-icon::after,
.menu-icon span {
    position: absolute;
    left: 0;
    width: 100%;
    height: 3px;
    background-color: #444;
    content: '';
    transition: all 0.3s ease;
}

.menu-icon::before {
    top: 0;
}

.menu-icon span {
    top: 7.5px;
}

.menu-icon::after {
    bottom: 0;
}

.menu-dropdown {
    position: absolute;
    top: 54px;
    right: 0;
    background-color: #ffffff; /* Explicit background color */
    border: 2px solid #cccccc; /* Explicit border color */
    border-radius: 6px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    width: 200px;
    max-width: 90vw;
    display: none;
    z-index: 1000; /* Ensure menu appears above other elements */
    overflow: hidden;
    opacity: 1; /* Ensure it's not transparent */
    max-height: 80vh;
    overflow-y: auto;
}

.menu-dropdown.active {
    display: block;
}

.menu-dropdown::before {
    content: '';
    position: absolute;
    top: -8px;
    right: 16px;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-bottom: 8px solid #cccccc; /* Explicit color */
}

.menu-item {
    width: 100%;
    padding: 12px 15px;
    text-align: left;
    background-color: #ffffff; /* Explicit background color */
    border: none;
    border-bottom: 1px solid #cccccc; /* Explicit border color */
    font-family: 'Trebuchet MS', Arial, sans-serif;
    font-size: 0.95rem;
    cursor: pointer;
    transition: background 0.2s ease;
    color: #444;
    display: block;
}

.menu-item:last-child {
    border-bottom: none;
}

.menu-item:hover {
    background-color: #e8e8e8;
}

/* Separator for menu sections */
.menu-separator {
    height: 1px;
    background-color: #cccccc;
    margin: 5px 0;
    opacity: 1;
}

/* Separate styling for hint level buttons */
.menu-item.hint-button[id^="hint-level-"] {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Separate styling for island reduction buttons */
.menu-item.hint-button[id^="island-level-"] {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Active state for hint level buttons only */
.menu-item.hint-button[id^="hint-level-"].active-hint {
    background-color: #e0e0e0;
    font-weight: bold;
}

/* Active state for island reduction buttons only */
.menu-item.hint-button[id^="island-level-"].active-island {
    background-color: #e0e0e0;
    font-weight: bold;
}

/* Disabled state for hint level buttons */
.menu-item.hint-button[id^="hint-level-"].disabled-hint,
.disabled-hint {
    color: grey !important;
    cursor: not-allowed;
}

/* Disabled state for island reduction buttons */
.menu-item.hint-button[id^="island-level-"].disabled-island {
    color: grey !important;
    cursor: not-allowed;
}

/* Medium/Small screens */
@media (max-width: 768px) {
    #menu-button-container {
        top: 5px;
        right: 10px;
    }
    
    .menu-item {
        padding: 10px 12px;
        font-size: 0.9rem;
    }
}

/* ==========================================================================
   6. Menu Animations
   ========================================================================== */

/* Menu icon animation */
.menu-button.active .menu-icon::before {
    transform: translateY(7.5px) rotate(45deg);
}

.menu-button.active .menu-icon::after {
    transform: translateY(-7.5px) rotate(-45deg);
}

.menu-button.active .menu-icon span {
    opacity: 0;
}

/* ==========================================================================
   7. Animation and Touch Handling (preserved from original)
   ========================================================================== */

.grid-container {
  transition-property: transform;
  transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
  will-change: transform;
}

.grid-container.fast-scroll {
  transition-duration: 200ms;
}

.grid-container.slow-scroll {
  transition-duration: 400ms;
}

/* Animation for button clicks - WITHOUT TRANSLATION */
@keyframes button-pulse {
    0% { transform: scale(1); }
    50% { 
        transform: scale(1.02);
        background: repeating-linear-gradient(
            120deg,
            var(--btn-metal-lighter) 0px,
            var(--btn-metal-light) 15px,
            var(--btn-metal-lighter) 35px,
            var(--btn-metal-mediumlight) 60px,
            var(--btn-metal-light) 85px,
            var(--btn-metal-mediumlight) 100px,
            var(--btn-metal-lighter) 125px,
            var(--btn-metal-light) 140px
        );
    }
    100% { 
        transform: scale(1);
        background: repeating-linear-gradient(
            120deg,
            var(--btn-metal-light) 0px,
            var(--btn-metal-medium) 10px,
            var(--btn-metal-light) 30px,
            var(--btn-metal-mediumlight) 55px,
            var(--btn-metal-medium) 80px,
            var(--btn-metal-mediumlight) 95px,
            var(--btn-metal-light) 120px,
            var(--btn-metal-medium) 135px
        );
    }
}

/* Hide the refresh button container (replaced by menu) */
.refresh-button-container {
    display: none;
}

/* Better GPU acceleration for all grid components */
.grid-container, .grid-cell, .snake-piece {
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* ==========================================================================
   8. Erosion Animation Effects 
   ========================================================================== */

/* Styling for cells that are about to be eroded */
.grid-cell.eroding-cell {
    animation: eroding-pulse 1s infinite alternate;
    transition: background-color 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
    z-index: 8; /* Ensure eroding cells appear above regular cells */
}

/* Flashing animation for cells about to be eroded */
@keyframes eroding-pulse {
    0% {
        opacity: 1;
        background-color: var(--defaultblue-light);
        border-color: var(--defaultblue);
    }
    100% {
        opacity: 0.5;
        background-color: var(--maingreen-light);
        border-color: var(--maingreen-dark);
    }
}

/* Class toggled for flash animation */
.grid-cell.eroding-cell.flash-visible {
    opacity: 1;
    background-color: var(--sandyellow);
    border-color: var(--sandyellow);
}

/* Path cells flashing as final warning is higher priority */
.grid-cell.eroding-cell.path-cell.flash-visible {
    z-index: 10;
    background-color: #ff6b6b !important;
    color: white !important;
    font-weight: bold !important;
    box-shadow: 0 0 8px rgba(255, 0, 0, 0.6) !important;
    transform: scale(1.05);
}

/* Game over message styling */
#message-container {
    font-family: 'Trebuchet MS', Arial, sans-serif;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
    max-width: 90%;
    line-height: 1.4;
    z-index: 1000;
}

#retry-button {
    margin-top: 15px;
    padding: 8px 15px;
    background: #fff;
    color: #d32f2f;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease, transform 0.2s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

#retry-button:hover {
    background-color: #f8f8f8;
    transform: scale(1.05);
}

#retry-button:active {
    transform: scale(0.98);
}

/* Ensure eroding cells flashing takes priority over other states */
.grid-cell.eroding-cell.path-cell {
    z-index: 9;
}
